<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="668px" preserveAspectRatio="none" style="width:1645px;height:668px;" version="1.1" viewBox="0 0 1645 668" width="1645px" zoomAndPan="magnify"><defs><filter height="300%" id="f1uvvlnm89vdes" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--MD5=[335f4d9be48430461c68bf6d6fdba145]
class App--><rect codeLine="2" fill="#FEFECE" filter="url(#f1uvvlnm89vdes)" height="60.8047" id="App" style="stroke:#A80036;stroke-width:1.5;" width="160" x="901" y="7"/><ellipse cx="964.75" cy="23" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M967.7188,28.6406 Q967.1406,28.9375 966.5,29.0781 Q965.8594,29.2344 965.1563,29.2344 Q962.6563,29.2344 961.3281,27.5938 Q960.0156,25.9375 960.0156,22.8125 Q960.0156,19.6875 961.3281,18.0313 Q962.6563,16.375 965.1563,16.375 Q965.8594,16.375 966.5,16.5313 Q967.1563,16.6875 967.7188,16.9844 L967.7188,19.7031 Q967.0938,19.125 966.5,18.8594 Q965.9063,18.5781 965.2813,18.5781 Q963.9375,18.5781 963.25,19.6563 Q962.5625,20.7188 962.5625,22.8125 Q962.5625,24.9063 963.25,25.9844 Q963.9375,27.0469 965.2813,27.0469 Q965.9063,27.0469 966.5,26.7813 Q967.0938,26.5 967.7188,25.9219 L967.7188,28.6406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="24" x="985.25" y="27.1543">App</text><line style="stroke:#A80036;stroke-width:1.5;" x1="902" x2="1060" y1="39" y2="39"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="909" y="47"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="134" x="921" y="53.2104">SERVER_SECRET: string</text><line style="stroke:#A80036;stroke-width:1.5;" x1="902" x2="1060" y1="59.8047" y2="59.8047"/><!--MD5=[1f1f201fabd7e91782bcb1bb8a0d84c9]
class TokenContent--><rect codeLine="6" fill="#FEFECE" filter="url(#f1uvvlnm89vdes)" height="73.6094" id="TokenContent" style="stroke:#A80036;stroke-width:1.5;" width="134" x="7" y="340.5"/><ellipse cx="28.3" cy="356.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M31.2688,362.1406 Q30.6906,362.4375 30.05,362.5781 Q29.4094,362.7344 28.7063,362.7344 Q26.2063,362.7344 24.8781,361.0938 Q23.5656,359.4375 23.5656,356.3125 Q23.5656,353.1875 24.8781,351.5313 Q26.2063,349.875 28.7063,349.875 Q29.4094,349.875 30.05,350.0313 Q30.7063,350.1875 31.2688,350.4844 L31.2688,353.2031 Q30.6438,352.625 30.05,352.3594 Q29.4563,352.0781 28.8313,352.0781 Q27.4875,352.0781 26.8,353.1563 Q26.1125,354.2188 26.1125,356.3125 Q26.1125,358.4063 26.8,359.4844 Q27.4875,360.5469 28.8313,360.5469 Q29.4563,360.5469 30.05,360.2813 Q30.6438,360 31.2688,359.4219 L31.2688,362.1406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="88" x="43.7" y="360.6543">TokenContent</text><line style="stroke:#A80036;stroke-width:1.5;" x1="8" x2="140" y1="372.5" y2="372.5"/><ellipse cx="18" cy="383.5" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="99" x="27" y="386.7104">username: string</text><ellipse cx="18" cy="396.3047" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="108" x="27" y="399.5151">expiration: number</text><line style="stroke:#A80036;stroke-width:1.5;" x1="8" x2="140" y1="406.1094" y2="406.1094"/><!--MD5=[2c8b070088f9e9a5dfda32644ea219c6]
class AuthenticationController--><rect codeLine="11" fill="#FEFECE" filter="url(#f1uvvlnm89vdes)" height="137.6328" id="AuthenticationController" style="stroke:#A80036;stroke-width:1.5;" width="354" x="804" y="129"/><ellipse cx="900.25" cy="145" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M903.2188,150.6406 Q902.6406,150.9375 902,151.0781 Q901.3594,151.2344 900.6563,151.2344 Q898.1563,151.2344 896.8281,149.5938 Q895.5156,147.9375 895.5156,144.8125 Q895.5156,141.6875 896.8281,140.0313 Q898.1563,138.375 900.6563,138.375 Q901.3594,138.375 902,138.5313 Q902.6563,138.6875 903.2188,138.9844 L903.2188,141.7031 Q902.5938,141.125 902,140.8594 Q901.4063,140.5781 900.7813,140.5781 Q899.4375,140.5781 898.75,141.6563 Q898.0625,142.7188 898.0625,144.8125 Q898.0625,146.9063 898.75,147.9844 Q899.4375,149.0469 900.7813,149.0469 Q901.4063,149.0469 902,148.7813 Q902.5938,148.5 903.2188,147.9219 L903.2188,150.6406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="153" x="920.75" y="149.1543">AuthenticationController</text><line style="stroke:#A80036;stroke-width:1.5;" x1="805" x2="1157" y1="161" y2="161"/><line style="stroke:#A80036;stroke-width:1.5;" x1="805" x2="1157" y1="169" y2="169"/><ellipse cx="815" cy="180" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="241" x="824" y="183.2104">signUp(req: SignUpReq, res: Object) : void</text><ellipse cx="815" cy="192.8047" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="309" x="824" y="196.0151">validateEmail(req: ValidateEmailReq, res: Object): void</text><ellipse cx="815" cy="205.6094" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="219" x="824" y="208.8198">login(req: LoginReq, res: Object) : void</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="812" y="215.4141"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="324" x="824" y="221.6245">signToken(content: TokenContent, secret: string) : string</text><ellipse cx="815" cy="231.2188" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="248" x="824" y="234.4292">refresh(req: RefreshReq, res: Object) : void</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="812" y="241.0234"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="328" x="824" y="247.2339">extractToken(token: string, secret: string) : TokenContent</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="812" y="253.8281"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="178" x="824" y="260.0386">generateRefreshToken(): string</text><!--MD5=[fc094a455342c7a8a159384761327e74]
class EmailValidator--><rect codeLine="78" fill="#FEFECE" filter="url(#f1uvvlnm89vdes)" height="99.2188" id="EmailValidator" style="stroke:#A80036;stroke-width:1.5;" width="332" x="176" y="328"/><ellipse cx="293.25" cy="344" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M296.2188,349.6406 Q295.6406,349.9375 295,350.0781 Q294.3594,350.2344 293.6563,350.2344 Q291.1563,350.2344 289.8281,348.5938 Q288.5156,346.9375 288.5156,343.8125 Q288.5156,340.6875 289.8281,339.0313 Q291.1563,337.375 293.6563,337.375 Q294.3594,337.375 295,337.5313 Q295.6563,337.6875 296.2188,337.9844 L296.2188,340.7031 Q295.5938,340.125 295,339.8594 Q294.4063,339.5781 293.7813,339.5781 Q292.4375,339.5781 291.75,340.6563 Q291.0625,341.7188 291.0625,343.8125 Q291.0625,345.9063 291.75,346.9844 Q292.4375,348.0469 293.7813,348.0469 Q294.4063,348.0469 295,347.7813 Q295.5938,347.5 296.2188,346.9219 L296.2188,349.6406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="89" x="313.75" y="348.1543">EmailValidator</text><line style="stroke:#A80036;stroke-width:1.5;" x1="177" x2="507" y1="360" y2="360"/><ellipse cx="187" cy="371" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="210" x="196" y="374.2104">userToToken: Map&lt;ObjectId, string&gt;</text><line style="stroke:#A80036;stroke-width:1.5;" x1="177" x2="507" y1="380.8047" y2="380.8047"/><ellipse cx="187" cy="391.8047" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="306" x="196" y="395.0151">sendTokenToEmail(user: ObjectId, email: string): void</text><ellipse cx="187" cy="404.6094" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="287" x="196" y="407.8198">checkToken(user: ObjectId, token: string): boolean</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="184" y="414.4141"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="189" x="196" y="420.6245">generateValidationToken(): string</text><!--MD5=[bf1f63756adf75f7ecdeacd63242982d]
class SignUpReq--><rect codeLine="24" fill="#FEFECE" filter="url(#f1uvvlnm89vdes)" height="86.4141" id="SignUpReq" style="stroke:#A80036;stroke-width:1.5;" width="152" x="543" y="334.5"/><ellipse cx="581.4" cy="350.5" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M577.3219,346.2656 L577.3219,344.1094 L584.7125,344.1094 L584.7125,346.2656 L582.2438,346.2656 L582.2438,354.3438 L584.7125,354.3438 L584.7125,356.5 L577.3219,356.5 L577.3219,354.3438 L579.7906,354.3438 L579.7906,346.2656 L577.3219,346.2656 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="68" x="600.6" y="354.6543">SignUpReq</text><line style="stroke:#A80036;stroke-width:1.5;" x1="544" x2="694" y1="366.5" y2="366.5"/><ellipse cx="554" cy="377.5" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="72" x="563" y="380.7104">email: string</text><ellipse cx="554" cy="390.3047" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="99" x="563" y="393.5151">username: string</text><ellipse cx="554" cy="403.1094" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="126" x="563" y="406.3198">passwordHash: string</text><line style="stroke:#A80036;stroke-width:1.5;" x1="544" x2="694" y1="412.9141" y2="412.9141"/><!--MD5=[657c1d01b99145a82e031c80cde6b9c8]
class ValidateEmailReq--><rect codeLine="30" fill="#FEFECE" filter="url(#f1uvvlnm89vdes)" height="60.8047" id="ValidateEmailReq" style="stroke:#A80036;stroke-width:1.5;" width="140" x="730" y="347"/><ellipse cx="745" cy="363" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M740.9219,358.7656 L740.9219,356.6094 L748.3125,356.6094 L748.3125,358.7656 L745.8438,358.7656 L745.8438,366.8438 L748.3125,366.8438 L748.3125,369 L740.9219,369 L740.9219,366.8438 L743.3906,366.8438 L743.3906,358.7656 L740.9219,358.7656 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="108" x="759" y="367.1543">ValidateEmailReq</text><line style="stroke:#A80036;stroke-width:1.5;" x1="731" x2="869" y1="379" y2="379"/><ellipse cx="741" cy="390" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="72" x="750" y="393.2104">token: string</text><line style="stroke:#A80036;stroke-width:1.5;" x1="731" x2="869" y1="399.8047" y2="399.8047"/><!--MD5=[c261b89841acff94ebe7e695b23dc22b]
class LoginReq--><rect codeLine="34" fill="#FEFECE" filter="url(#f1uvvlnm89vdes)" height="73.6094" id="LoginReq" style="stroke:#A80036;stroke-width:1.5;" width="152" x="905" y="340.5"/><ellipse cx="947.9" cy="356.5" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M943.8219,352.2656 L943.8219,350.1094 L951.2125,350.1094 L951.2125,352.2656 L948.7438,352.2656 L948.7438,360.3438 L951.2125,360.3438 L951.2125,362.5 L943.8219,362.5 L943.8219,360.3438 L946.2906,360.3438 L946.2906,352.2656 L943.8219,352.2656 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="58" x="968.1" y="360.6543">LoginReq</text><line style="stroke:#A80036;stroke-width:1.5;" x1="906" x2="1056" y1="372.5" y2="372.5"/><ellipse cx="916" cy="383.5" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="99" x="925" y="386.7104">username: string</text><ellipse cx="916" cy="396.3047" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="126" x="925" y="399.5151">passwordHash: string</text><line style="stroke:#A80036;stroke-width:1.5;" x1="906" x2="1056" y1="406.1094" y2="406.1094"/><!--MD5=[595dc81cf4b779cf924885e1bf70d0cb]
class LoginRes--><rect codeLine="38" fill="#FEFECE" filter="url(#f1uvvlnm89vdes)" height="73.6094" id="LoginRes" style="stroke:#A80036;stroke-width:1.5;" width="146" x="995" y="542"/><ellipse cx="1036.1" cy="558" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1032.0219,553.7656 L1032.0219,551.6094 L1039.4125,551.6094 L1039.4125,553.7656 L1036.9438,553.7656 L1036.9438,561.8438 L1039.4125,561.8438 L1039.4125,564 L1032.0219,564 L1032.0219,561.8438 L1034.4906,561.8438 L1034.4906,553.7656 L1032.0219,553.7656 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="56" x="1055.9" y="562.1543">LoginRes</text><line style="stroke:#A80036;stroke-width:1.5;" x1="996" x2="1140" y1="574" y2="574"/><ellipse cx="1006" cy="585" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="118" x="1015" y="588.2104">access_token: string</text><ellipse cx="1006" cy="597.8047" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="120" x="1015" y="601.0151">refresh_token: string</text><line style="stroke:#A80036;stroke-width:1.5;" x1="996" x2="1140" y1="607.6094" y2="607.6094"/><!--MD5=[2b41c1218da8f2d2d7879c0f580de5d0]
class RefreshReq--><rect codeLine="44" fill="#FEFECE" filter="url(#f1uvvlnm89vdes)" height="60.8047" id="RefreshReq" style="stroke:#A80036;stroke-width:1.5;" width="146" x="1163" y="347"/><ellipse cx="1197.35" cy="363" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1193.2719,358.7656 L1193.2719,356.6094 L1200.6625,356.6094 L1200.6625,358.7656 L1198.1938,358.7656 L1198.1938,366.8438 L1200.6625,366.8438 L1200.6625,369 L1193.2719,369 L1193.2719,366.8438 L1195.7406,366.8438 L1195.7406,358.7656 L1193.2719,358.7656 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="71" x="1215.65" y="367.1543">RefreshReq</text><line style="stroke:#A80036;stroke-width:1.5;" x1="1164" x2="1308" y1="379" y2="379"/><ellipse cx="1174" cy="390" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="120" x="1183" y="393.2104">refresh_token: string</text><line style="stroke:#A80036;stroke-width:1.5;" x1="1164" x2="1308" y1="399.8047" y2="399.8047"/><!--MD5=[8f785c9c405d286e477f8762e0176cd0]
class RefreshRes--><rect codeLine="47" fill="#FEFECE" filter="url(#f1uvvlnm89vdes)" height="60.8047" id="RefreshRes" style="stroke:#A80036;stroke-width:1.5;" width="173" x="1199.5" y="548.5"/><ellipse cx="1247.25" cy="564.5" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1243.1719,560.2656 L1243.1719,558.1094 L1250.5625,558.1094 L1250.5625,560.2656 L1248.0938,560.2656 L1248.0938,568.3438 L1250.5625,568.3438 L1250.5625,570.5 L1243.1719,570.5 L1243.1719,568.3438 L1245.6406,568.3438 L1245.6406,560.2656 L1243.1719,560.2656 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="69" x="1267.75" y="568.6543">RefreshRes</text><line style="stroke:#A80036;stroke-width:1.5;" x1="1200.5" x2="1371.5" y1="580.5" y2="580.5"/><ellipse cx="1210.5" cy="591.5" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="147" x="1219.5" y="594.7104">new_access_token: string</text><line style="stroke:#A80036;stroke-width:1.5;" x1="1200.5" x2="1371.5" y1="601.3047" y2="601.3047"/><!--MD5=[c2d105e52fbb731d58293327cfa51995]
class UserModel--><rect codeLine="61" fill="#FEFECE" filter="url(#f1uvvlnm89vdes)" height="60.8047" id="UserModel" style="stroke:#A80036;stroke-width:1.5;" width="216" x="1415" y="347"/><ellipse cx="1485.75" cy="363" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1488.7188,368.6406 Q1488.1406,368.9375 1487.5,369.0781 Q1486.8594,369.2344 1486.1563,369.2344 Q1483.6563,369.2344 1482.3281,367.5938 Q1481.0156,365.9375 1481.0156,362.8125 Q1481.0156,359.6875 1482.3281,358.0313 Q1483.6563,356.375 1486.1563,356.375 Q1486.8594,356.375 1487.5,356.5313 Q1488.1563,356.6875 1488.7188,356.9844 L1488.7188,359.7031 Q1488.0938,359.125 1487.5,358.8594 Q1486.9063,358.5781 1486.2813,358.5781 Q1484.9375,358.5781 1484.25,359.6563 Q1483.5625,360.7188 1483.5625,362.8125 Q1483.5625,364.9063 1484.25,365.9844 Q1484.9375,367.0469 1486.2813,367.0469 Q1486.9063,367.0469 1487.5,366.7813 Q1488.0938,366.5 1488.7188,365.9219 L1488.7188,368.6406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="66" x="1506.25" y="367.1543">UserModel</text><line style="stroke:#A80036;stroke-width:1.5;" x1="1416" x2="1630" y1="379" y2="379"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1416" x2="1630" y1="387" y2="387"/><ellipse cx="1426" cy="398" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="190" x="1435" y="401.2104">findOne(username: string) : User</text><!--MD5=[3fd616f346a44cd59a91eb10b19e157c]
class User--><rect codeLine="67" fill="#FEFECE" filter="url(#f1uvvlnm89vdes)" height="150.4375" id="User" style="stroke:#A80036;stroke-width:1.5;" width="184" x="1431" y="504"/><ellipse cx="1504.25" cy="520" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1507.2188,525.6406 Q1506.6406,525.9375 1506,526.0781 Q1505.3594,526.2344 1504.6563,526.2344 Q1502.1563,526.2344 1500.8281,524.5938 Q1499.5156,522.9375 1499.5156,519.8125 Q1499.5156,516.6875 1500.8281,515.0313 Q1502.1563,513.375 1504.6563,513.375 Q1505.3594,513.375 1506,513.5313 Q1506.6563,513.6875 1507.2188,513.9844 L1507.2188,516.7031 Q1506.5938,516.125 1506,515.8594 Q1505.4063,515.5781 1504.7813,515.5781 Q1503.4375,515.5781 1502.75,516.6563 Q1502.0625,517.7188 1502.0625,519.8125 Q1502.0625,521.9063 1502.75,522.9844 Q1503.4375,524.0469 1504.7813,524.0469 Q1505.4063,524.0469 1506,523.7813 Q1506.5938,523.5 1507.2188,522.9219 L1507.2188,525.6406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="29" x="1524.75" y="524.1543">User</text><line style="stroke:#A80036;stroke-width:1.5;" x1="1432" x2="1614" y1="536" y2="536"/><ellipse cx="1442" cy="547" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="64" x="1451" y="550.2104">id: ObjectId</text><ellipse cx="1442" cy="559.8047" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="72" x="1451" y="563.0151">email: string</text><ellipse cx="1442" cy="572.6094" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="135" x="1451" y="575.8198">validatedEmail: boolean</text><ellipse cx="1442" cy="585.4141" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="99" x="1451" y="588.6245">username: string</text><ellipse cx="1442" cy="598.2188" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="126" x="1451" y="601.4292">passwordHash: string</text><ellipse cx="1442" cy="611.0234" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="100" x="1451" y="614.2339">authToken: string</text><ellipse cx="1442" cy="623.8281" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="117" x="1451" y="627.0386">refreshToken: string</text><line style="stroke:#A80036;stroke-width:1.5;" x1="1432" x2="1614" y1="633.6328" y2="633.6328"/><ellipse cx="1442" cy="644.6328" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="158" x="1451" y="647.8433">isValidPassword() : boolean</text><!--MD5=[349429ef4703781a5b48ce9adfc11579]
link AuthenticationController to TokenContent--><path codeLine="21" d="M803.82,207.96 C633.97,220.89 372.44,252.25 158,328 C150.24,330.74 142.39,334.2 134.75,338.01 " fill="none" id="AuthenticationController-to-TokenContent" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="130.03,340.42,139.8643,339.8846,134.4819,338.1439,136.2226,332.7616,130.03,340.42" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[215800ceee6a54215a63ae78e47d8d83]
link AuthenticationController to EmailValidator--><path codeLine="22" d="M803.85,248.21 C713.14,273.41 603.18,303.95 513.31,328.91 " fill="none" id="AuthenticationController-to-EmailValidator" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="508.23,330.32,517.9738,331.7548,513.0462,328.9766,515.8244,324.049,508.23,330.32" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[6e22055566f2c5cf6cc270c0daff2a43]
link LoginReq to LoginRes--><!--MD5=[4fa773ce058c6cc5fca8d9ed756b3c3b]
link RefreshReq to RefreshRes--><!--MD5=[9f5d5ff34f56b09567e5cbcd262251be]
link AuthenticationController to SignUpReq--><path codeLine="52" d="M836.77,267.07 C796.27,286.48 752.3,307.84 712,328 C707.93,330.03 703.78,332.13 699.58,334.27 " fill="none" id="AuthenticationController-to-SignUpReq" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#A80036" points="695.02,336.59,704.855,336.0674,699.4749,334.3197,701.2226,328.9396,695.02,336.59" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[e74d94e3e628c7fb757da411b69881a2]
link AuthenticationController to LoginReq--><path codeLine="53" d="M981,267.12 C981,290.01 981,314.84 981,335.05 " fill="none" id="AuthenticationController-to-LoginReq" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#A80036" points="981,340.08,985,331.08,981,335.08,977,331.08,981,340.08" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[1d670a76dc1ea9c59cc8c2373eab67db]
link AuthenticationController to LoginRes--><path codeLine="54" d="M1042.09,267.25 C1055.15,285.73 1067.09,306.59 1074,328 C1096.76,398.5 1086.51,486.09 1077.15,536.66 " fill="none" id="AuthenticationController-to-LoginRes" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#A80036" points="1076.19,541.74,1081.7915,533.6392,1077.1183,536.8269,1073.9306,532.1538,1076.19,541.74" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[a2638a6c726f04bd37c85a15e24d4133]
link AuthenticationController to RefreshReq--><path codeLine="55" d="M1092.04,267.16 C1106.99,276.93 1121.99,287.04 1136,297 C1156.51,311.57 1178.47,328.84 1196.58,343.55 " fill="none" id="AuthenticationController-to-RefreshReq" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#A80036" points="1200.62,346.84,1196.1573,338.0602,1196.7394,343.687,1191.1126,344.2691,1200.62,346.84" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[6e0bd0fe5c38886e233a90bc1556f517]
link AuthenticationController to RefreshRes--><path codeLine="56" d="M1158.19,222.73 C1221.89,240.77 1287.46,272.44 1326,328 C1371.6,393.73 1332.14,492.37 1305.52,543.89 " fill="none" id="AuthenticationController-to-RefreshRes" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#A80036" points="1303.15,548.43,1310.879,542.3256,1305.477,544.0045,1303.7981,538.6025,1303.15,548.43" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[3ea7b854100ff602a8351ac560c3c0f6]
link AuthenticationController to ValidateEmailReq--><path codeLine="57" d="M911.54,267.12 C884.96,293.18 855.82,321.76 834,343.16 " fill="none" id="AuthenticationController-to-ValidateEmailReq" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#A80036" points="830.28,346.8,839.5076,343.3575,833.8511,343.3004,833.9082,337.6438,830.28,346.8" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[2adfbe990a12dc04df57f2a2ca8f6ba0]
link App to AuthenticationController--><path codeLine="59" d="M981,68.31 C981,83.97 981,103.91 981,123.39 " fill="none" id="App-to-AuthenticationController" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="981,128.87,985,119.87,981,123.87,977,119.87,981,128.87" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[b8f32eef931d702e24f753698d2e89d8]
link AuthenticationController to UserModel--><path codeLine="65" d="M1158.09,229.72 C1230.84,245.38 1314.98,267.47 1388,297 C1418.75,309.43 1450.84,328.06 1476.01,344.16 " fill="none" id="AuthenticationController-to-UserModel" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1480.31,346.93,1474.9024,338.6985,1476.1041,344.2262,1470.5764,345.4279,1480.31,346.93" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[4ecea6bf7c2c095d84c358f3c79267fb]
reverse link UserModel to User--><path codeLine="85" d="M1523,421.68 C1523,445.68 1523,476.22 1523,503.92 " fill="none" id="UserModel-backto-User" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1523,408.37,1519,414.37,1523,420.37,1527,414.37,1523,408.37" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="35" x="1524" y="470.0669">users</text><!--MD5=[230c5b6864f16aa1c7bb6d77602785ee]
@startuml Authentication Class Diagram

class App {
    -SERVER_SECRET: string
}

class TokenContent {
    +username: string
    +expiration: number
}

class AuthenticationController {
    +signUp(req: SignUpReq, res: Object) : void
    +validateEmail(req: ValidateEmailReq, res: Object): void
    +login(req: LoginReq, res: Object) : void
    -signToken(content: TokenContent, secret: string) : string
    +refresh(req: RefreshReq, res: Object) : void
    -extractToken(token: string, secret: string) : TokenContent
    -generateRefreshToken(): string
}

AuthenticationController - -> TokenContent
AuthenticationController - -> EmailValidator

interface SignUpReq {
    +email: string
    +username: string
    +passwordHash: string
}

interface ValidateEmailReq {
    +token: string
}

interface LoginReq {
    +username: string
    +passwordHash: string
}
interface LoginRes {
    +access_token: string
    +refresh_token: string
}
LoginReq -[hidden]-> LoginRes

interface RefreshReq {
    +refresh_token: string
}
interface RefreshRes {
    +new_access_token: string
}
RefreshReq -[hidden]-> RefreshRes

AuthenticationController ..> SignUpReq
AuthenticationController ..> LoginReq
AuthenticationController ..> LoginRes
AuthenticationController ..> RefreshReq
AuthenticationController ..> RefreshRes
AuthenticationController ..> ValidateEmailReq

App - -> AuthenticationController

class UserModel {
    +findOne(username: string) : User
}

AuthenticationController - -> UserModel

class User {
    +id: ObjectId
    +email: string
    +validatedEmail: boolean
    +username: string
    +passwordHash: string
    +authToken: string
    +refreshToken: string
    +isValidPassword() : boolean
}

class EmailValidator {
    +userToToken: Map<ObjectId, string>
    +{static} sendTokenToEmail(user: ObjectId, email: string): void
    +{static} checkToken(user: ObjectId, token: string): boolean
    -generateValidationToken(): string
}

UserModel *- - User : users

@enduml

PlantUML version 1.2020.22(Sun Dec 06 12:36:27 EET 2020)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>